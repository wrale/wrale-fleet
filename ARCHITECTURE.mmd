```mermaid
graph TB
    subgraph Core ["Wrale Fleet Core"]
        fleet["fleet/"]
        metal["metal/"]
        shared["shared/"]
        user["user/"]
    end

    %% Metal Layer (Hardware Control)
    subgraph MetalLayer ["metal/ - Physical Hardware Layer"]
        metal --> metalCore["core/"]
        metal --> metalDiag["diag/"]
        metal --> metalHw["hw/"]
        
        %% Hardware Components
        subgraph HardwareControl ["hw/ - Direct Hardware Control"]
            metalHw --> gpio["gpio/"]
            metalHw --> power["power/"]
            metalHw --> secure["secure/"]
            metalHw --> thermal["thermal/"]
            metalHw --> hwDiag["diag/"]
        end

        %% Core Components
        subgraph CoreComponents ["core/ - System Coordination"]
            metalCore --> metald["cmd/metald"]
            metalCore --> coreServer["server/"]
            metalCore --> coreSecure["secure/"]
            metalCore --> coreThermal["thermal/"]
        end
    end

    %% Fleet Layer (Management)
    subgraph FleetLayer ["fleet/ - Fleet Management"]
        fleet --> brain["brain/"]
        fleet --> edge["edge/"]
        fleet --> sync["sync/"]

        subgraph FleetComponents["Fleet Components"]
            brain --> brainCoord["Device Coordination"]
            brain --> brainPolicy["Policy Management"]
            
            edge --> edgeComm["Edge Communication"]
            edge --> edgeState["State Management"]
            
            sync --> syncData["Data Synchronization"]
            sync --> syncConfig["Config Distribution"]
        end
    end

    %% User Layer (Interfaces)
    subgraph UserLayer ["user/ - User Interfaces"]
        user --> api["api/"]
        user --> ui["ui/"]

        subgraph UI ["ui/wrale-dashboard"]
            ui --> components["components/"]
            ui --> pages["pages/"]
            ui --> services["services/"]
            ui --> types["types/"]
        end

        subgraph API ["api/"]
            api --> handlers["API Handlers"]
            api --> auth["Authentication"]
        end
    end

    %% Shared Infrastructure
    subgraph SharedLayer ["shared/ - Common Infrastructure"]
        shared --> config["config/"]
        shared --> docs["docs/"]
        shared --> testing["testing/"]
        shared --> tools["tools/"]
    end

    %% Data Flow Relationships
    user -->|HTTP API| fleet
    fleet -->|Commands| metal
    metal -->|Status Updates| fleet
    fleet -->|Updates| user
    shared -->|Used By| metal
    shared -->|Used By| fleet
    shared -->|Used By| user

    %% Physical World Interaction
    metalHw -->|Controls| Hardware["Physical Hardware"]
    metalDiag -->|Monitors| Hardware
    Hardware -->|Sends Data| metalHw

    %% Legend / Notes
    classDef primary fill:#f9f,stroke:#333,stroke-width:2px
    classDef secondary fill:#bbf,stroke:#333,stroke-width:1px
    classDef hardware fill:#fbb,stroke:#333,stroke-width:2px
    
    class Metal,Fleet,User primary
    class metalHw,metalCore,metalDiag secondary
    class Hardware hardware

    %% Additional Notes / Relationships
    note["Key Architectural Principles:
    1. Physical-First Philosophy
    2. Hardware is First-Class
    3. Environmental Factors Drive Design"]
```